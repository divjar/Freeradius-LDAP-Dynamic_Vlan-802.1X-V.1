server umm-tunnel {
    listen {
        type = auth
        ipaddr = *
        port = 18120
    }

authorize {
    if (&outer.session-state:) {
        update {
            &outer.session-state:Stripped-User-Name := &Stripped-User-Name
        }
    }

    inner-eap {
        ok = return
    }

    ldap
    
    # VLAN assignment berdasarkan LDAP Group
    if ("%{control:LDAP-Group}" =~ /Karyawan/) {
        update reply {
            Tunnel-Type := VLAN
            Tunnel-Medium-Type := IEEE-802
            Tunnel-Private-Group-ID := "192"
        }
    }
    elsif ("%{control:LDAP-Group}" =~ /Mahasiswa/) {
        update reply {
            Tunnel-Type := VLAN
            Tunnel-Medium-Type := IEEE-802
            Tunnel-Private-Group-ID := "254"
        }
    }
    
    pap
    mschap
}
    authenticate {
        Auth-Type MS-CHAP {
            mschap
        }
        Auth-Type PAP {
            pap
        }
        Auth-Type CHAP {
            chap
        }
        Auth-Type LDAP {
            ldap
        }
        eap
        inner-eap
    }
}
